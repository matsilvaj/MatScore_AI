{% extends "layout.html" %}
{% from "_macros.html" import render_field %}

{% block content %}
<div class="container mt-5">
    <h1 class="mb-4">Minha Conta</h1>
    
    <div class="row">
        <div class="col-md-6">
            <div class="card mb-4">
                <div class="card-header">
                    <h4>Informações do Perfil</h4>
                </div>
                <div class="card-body">
                    <p><strong>Nome de Utilizador:</strong> {{ current_user.username }}</p>
                    <p><strong>E-mail:</strong> {{ current_user.email }}</p>
                    <p><strong>Plano de Assinatura:</strong> <span class="badge bg-info text-capitalize">{{ current_user.subscription_tier }}</span></p>
                    <p><strong>E-mail Verificado:</strong> 
                        {% if current_user.email_verified %}
                            <span class="badge bg-success">Sim</span>
                        {% else %}
                            <span class="badge bg-warning">Não</span>
                        {% endif %}
                    </p>
                </div>
            </div>

            <div class="card mb-4">
                <div class="card-header">
                    <h4>Gerir Assinatura</h4>
                </div>
                <div class="card-body">
                    <p>A gestão da sua assinatura é feita através do portal do nosso parceiro de pagamentos, Stripe.</p>
                    <a href="#" class="btn btn-secondary">Portal do Cliente (Stripe)</a>
                    <small class="d-block mt-2">Nota: A integração com o portal do cliente Stripe é um passo futuro.</small>
                </div>
            </div>
        </div>

        <div class="col-md-6">
            <div class="card mb-4">
                <div class="card-header">
                    <h4>Alterar Senha</h4>
                </div>
                <div class="card-body">
                    <form method="POST" action="{{ url_for('main.change_password') }}" novalidate>
                        {{ change_password_form.hidden_tag() }}
                        
                        {{ render_field(change_password_form.current_password, placeholder="Sua senha atual") }}
                        {{ render_field(change_password_form.new_password, placeholder="Sua nova senha") }}
                        {{ render_field(change_password_form.confirm_new_password, placeholder="Confirme a nova senha") }}
                        
                        <div class="d-grid">
                            {{ change_password_form.submit(class="btn btn-warning") }}
                        </div>
                    </form>
                </div>
            </div>

            <div class="card border-danger mb-4">
                <div class="card-header bg-danger text-white">
                    <h4>Zona de Perigo</h4>
                </div>
                <div class="card-body">
                    <p>Esta ação não pode ser desfeita. Todos os seus dados serão permanentemente eliminados.</p>
                    <form method="POST" action="{{ url_for('main.delete_account') }}" onsubmit="return confirm('Tem a certeza que deseja excluir a sua conta permanentemente?');">
                        <input type="submit" value="Excluir Minha Conta" class="btn btn-danger">
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock content %}